---
phase: 05-shot-layer
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified:
  - core/shots/suggester.py
autonomous: true

must_haves:
  truths:
    - "ShotSuggester loads ScriptGraph from build directory"
    - "ShotSuggester generates shots for each scene"
    - "Every scene starts with an establishing wide shot"
    - "Shots are numbered sequentially within each scene"
    - "Shot list is saved to build/shotgraph.json"
  artifacts:
    - path: "core/shots/suggester.py"
      provides: "ShotSuggester orchestrator following BaseValidator pattern"
      exports: ["ShotSuggester", "ShotSuggestionResult"]
  key_links:
    - from: "core/shots/suggester.py"
      to: "core/shots/detector.py"
      via: "ShotDetector instance"
      pattern: "from .detector import"
    - from: "core/shots/suggester.py"
      to: "core/scriptgraph/schema.json"
      via: "Loads scriptgraph.json from build/"
      pattern: "scriptgraph.json"
---

<objective>
Create the ShotSuggester orchestrator that processes ScriptGraph scenes and generates shot suggestions.

Purpose: Orchestrate shot detection across all scenes, following the BaseValidator/ScriptBuilder pattern.
Output: suggester.py with ShotSuggester class
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Pattern references
@core/validation/base.py
@core/script/builder.py
@core/shots/detector.py
@core/shots/exporter.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create core/shots/suggester.py with ShotSuggester class</name>
  <files>core/shots/suggester.py</files>
  <action>
Create ShotSuggester class following the BaseValidator pattern from core/validation/base.py.

ShotSuggestionResult dataclass (similar to ScriptBuildResult):
- success: bool
- scenes_processed: int = 0
- shots_suggested: int = 0
- errors: List[str] = field(default_factory=list)

ShotSuggester class:
- __init__(self, build_path: Path):
  - Store build_path as Path
  - Initialize self._scriptgraph: Optional[Dict] = None
  - Initialize self._shots: List[Shot] = []
  - Initialize self._shot_counter: int = 0
  - Create ShotDetector instance

- _load_scriptgraph(self) -> None:
  - Load build/scriptgraph.json if exists
  - Set self._scriptgraph

- _create_shot_id(self, scene_number: int) -> str:
  - Increment self._shot_counter
  - Return f"shot_{scene_number:03d}_{self._shot_counter:03d}"

- _add_shot(self, scene: Dict, shot_type: ShotType, description: str, order: int, **kwargs) -> Shot:
  - Create Shot with all required fields
  - shot_id from _create_shot_id
  - scene_id from scene["id"]
  - scene_number from scene["order"]
  - shot_number = order
  - Include evidence_ids from kwargs or []
  - Append to self._shots
  - Return the Shot

- _suggest_for_scene(self, scene: Dict) -> None:
  - Always add establishing shot (WS) first with order=1
    - description: f"Establishing - {scene.get('slugline', 'Scene')}"
  - Analyze each paragraph with detector
  - Add detected shots with incrementing order numbers
  - Include two-shot detection if scene has exactly 2 characters in links

- suggest(self) -> ShotSuggestionResult:
  - Load scriptgraph if not loaded
  - Check for scenes, return error if none
  - Process each scene with _suggest_for_scene
  - Return result with statistics

- get_shots(self) -> List[Shot]:
  - Return copy of self._shots sorted by scene_number, shot_number

- get_shot_list(self) -> ShotList:
  - Create ShotList with project_id from scriptgraph
  - Populate with sorted shots
  - Return ShotList

- get_summary(self) -> Dict[str, Any]:
  - Return stats: total_shots, by_type (dict), by_scene (dict)

Convenience function:
- suggest_shots(build_path: Path) -> ShotSuggestionResult:
  - Create ShotSuggester, call suggest(), return result
</action>
  <verify>python -c "from core.shots.suggester import ShotSuggester; print('ShotSuggester imported successfully')"</verify>
  <done>ShotSuggester processes scenes and generates shots with establishing shots first</done>
</task>

</tasks>

<verification>
- ShotSuggester follows BaseValidator pattern structure
- Every scene gets an establishing wide shot as first shot
- Shots are numbered sequentially within scenes
- Shot IDs follow shot_XXX_YYY format
- Evidence IDs are propagated from paragraphs
</verification>

<success_criteria>
- ShotSuggester loads scriptgraph.json from build directory
- suggest() processes all scenes and returns ShotSuggestionResult
- get_shot_list() returns ShotList with shots sorted by scene/shot number
- Establishing shot is always first shot in each scene
</success_criteria>

<output>
After completion, create `.planning/phases/05-shot-layer/05-03-SUMMARY.md`
</output>
