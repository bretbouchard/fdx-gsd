---
phase: 07-media-archive
plan: 07
type: execute
wave: 5
depends_on: ["07-04", "07-05", "07-06"]
files_modified:
  - apps/cli/cli.py
autonomous: false

must_haves:
  truths:
    - "Archive status shows complete work hierarchy"
    - "User can verify all CLI commands work end-to-end"
  artifacts:
    - path: "apps/cli/cli.py"
      provides: "archive status command"
  key_links:
    - from: "gsd archive status"
      to: "core/archive/registry.py"
      via: "WorkRegistry.list_works"
---

<objective>
Add the `gsd archive status` command and verify the complete archive system end-to-end.

Purpose: Provide visibility into the archive contents and verify all commands work together.
Output: CLI status command and human verification checkpoint.
</objective>

<execution_context>
@/Users/bretbouchard/.claude/get-shit-done/workflows/execute-plan.md
@/Users/bretbouchard/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Required - all prior archive modules
@core/archive/models.py
@core/archive/registry.py
@core/archive/realization.py
@core/archive/performance.py

# CLI pattern
@apps/cli/cli.py

# Requirements reference
@.planning/REQUIREMENTS.md - Exit Criteria
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Archive Status Command</name>
  <files>apps/cli/cli.py</files>
  <action>
Add the `gsd archive status` command to show archive contents.

1. **Add cmd_archive_status function**:

```python
def cmd_archive_status(args: argparse.Namespace) -> int:
    """
    Show archive status and contents.

    Usage: gsd archive status [work_id]
    """
    project_path, exit_code = find_project_root()
    if exit_code != 0:
        print("Error: Not in a GSD project.")
        return exit_code

    archive_path = project_path / "archive"
    if not archive_path.exists():
        print("Archive not initialized. Run 'gsd archive init' first.")
        return 1

    from core.archive.registry import WorkRegistry
    from core.archive.realization import RealizationManager
    from core.archive.performance import PerformanceManager

    registry = WorkRegistry(archive_path)
    realization_mgr = RealizationManager(archive_path)
    performance_mgr = PerformanceManager(archive_path)

    # If work_id provided, show detailed status
    if args.work_id:
        work = registry.get_work_by_alias(args.work_id) or registry.get_work(args.work_id)
        if not work:
            print(f"Error: Work not found: {args.work_id}")
            return 1

        print(f"=== Work: {work.metadata.title} ===")
        print(f"ID: {work.id}")
        print(f"Type: {work.work_type}")
        if work.metadata.aliases:
            print(f"Aliases: {', '.join(work.metadata.aliases)}")
        if work.metadata.genre:
            print(f"Genre: {work.metadata.genre}")
        if work.metadata.year:
            print(f"Year: {work.metadata.year}")
        if work.metadata.isrc:
            print(f"ISRC: {work.metadata.isrc}")
        print(f"Created: {work.metadata.created_at.strftime('%Y-%m-%d')}")
        print()

        # Realizations
        realizations = realization_mgr.list_realizations(work.id)
        print(f"Realizations ({len(realizations)}):")
        for r in realizations:
            print(f"  [{r.id}] {r.metadata.name}")
            if r.metadata.date:
                print(f"    Date: {r.metadata.date}")
            if r.metadata.studio:
                print(f"    Studio: {r.metadata.studio}")
            sessions = len(r.sessions) if r.sessions else 0
            stems = len(r.stems) if r.stems else 0
            masters = len(r.masters) if r.masters else 0
            print(f"    Files: {sessions} sessions, {stems} stems, {masters} masters")
        print()

        # Performances
        performances = performance_mgr.list_performances(work.id)
        print(f"Performances ({len(performances)}):")
        for p in performances:
            print(f"  [{p.id}] {p.metadata.date}")
            if p.metadata.venue:
                print(f"    Venue: {p.metadata.venue}")
            audio = len(p.audio) if p.audio else 0
            video = len(p.video) if p.video else 0
            print(f"    Files: {audio} audio, {video} video")

        return 0

    # Show archive summary
    works = registry.list_works()

    print("=== Media Archive ===")
    print(f"Location: {archive_path}")
    print()

    if not works:
        print("No works registered.")
        print("Start with: gsd archive register \"Song Title\"")
        return 0

    # Count by type
    by_type = {}
    total_realizations = 0
    total_performances = 0

    for work in works:
        work_type = work.work_type or "other"
        by_type[work_type] = by_type.get(work_type, 0) + 1

        realizations = realization_mgr.list_realizations(work.id)
        performances = performance_mgr.list_performances(work.id)

        total_realizations += len(realizations)
        total_performances += len(performances)

    print(f"Works: {len(works)}")
    for wt, count in sorted(by_type.items()):
        print(f"  {wt}: {count}")
    print(f"Realizations: {total_realizations}")
    print(f"Performances: {total_performances}")
    print()

    # List all works
    print("Works:")
    for work in works:
        real_count = len(realization_mgr.list_realizations(work.id))
        perf_count = len(performance_mgr.list_performances(work.id))
        print(f"  [{work.id}] {work.metadata.title}")
        print(f"    {real_count} realizations, {perf_count} performances")

    return 0
```

2. **Add status subparser** to archive_sub:

```python
# archive status
p_status = archive_sub.add_parser("status", help="Show archive status")
p_status.add_argument("work_id", nargs="?", help="Work ID or alias for details")
p_status.set_defaults(func=cmd_archive_status, archive_command="status")
```
</action>
  <verify>
python -c "
import sys
sys.argv = ['gsd', 'archive', 'status', '--help']
# Should show help
" && echo "CLI parses archive status command"
</verify>
  <done>
`gsd archive status` shows archive summary; `gsd archive status {work_id}` shows work details.
</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete media archive system with:
- Git LFS configuration for all binary media types
- `gsd archive init` - Initialize archive structure
- `gsd archive register` - Register works with aliases
- `gsd archive realize` - Add studio realizations
- `gsd archive perform` - Archive live performances
- `gsd archive status` - View archive contents
</what-built>
  <how-to-verify>
1. Initialize a test archive:
   ```bash
   cd /Users/bretbouchard/apps/fdx_gsd
   python -m apps.cli.cli archive init
   ```

2. Register a work with aliases:
   ```bash
   python -m apps.cli.cli archive register "My Test Song" --alias "MTS" --alias "Test Demo" --genre "Rock" --year 2026
   ```

3. Add a realization:
   ```bash
   python -m apps.cli.cli archive realize work_XXXXX --name "Studio Version" --studio "Home Studio" --date 2026-02-19
   ```

4. Add a performance:
   ```bash
   python -m apps.cli.cli archive perform work_XXXXX --date 2026-02-19 --venue "The Troubadour" --personnel "John Doe"
   ```

5. Check status:
   ```bash
   python -m apps.cli.cli archive status
   python -m apps.cli.cli archive status work_XXXXX
   ```

6. Verify Git LFS config:
   ```bash
   cat .gitattributes | head -20
   ```

Expected: All commands execute without errors. Archive directory structure created correctly.
</how-to-verify>
  <resume-signal>Type "approved" if tests pass, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- [ ] `gsd archive status` shows work count and summary
- [ ] `gsd archive status {work_id}` shows detailed hierarchy
- [ ] All archive CLI commands work together
- [ ] Git LFS configuration present in .gitattributes
- [ ] Human verification passes
</verification>

<success_criteria>
- Archive status displays complete work hierarchy
- Realization and performance counts accurate
- All CLI commands function correctly
- Directory structure matches ROADMAP specification
</success_criteria>

<output>
After completion, create `.planning/phases/07-media-archive/07-07-SUMMARY.md`
</output>
